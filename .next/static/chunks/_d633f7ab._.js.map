{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yukia/Downloads/koku-lesson-planner/app/models/create/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, ChangeEvent, FormEvent } from \"react\";\r\nimport { useRouter, useParams } from \"next/navigation\";\r\n\r\ntype BoardImage = { name: string; src: string }; // 画像名とURL\r\n\r\ntype PracticeRecord = {\r\n  lessonId: string;\r\n  practiceDate: string;\r\n  reflection: string;\r\n  boardImages: BoardImage[];\r\n};\r\n\r\nexport default function PracticeAddPage() {\r\n  const router = useRouter();\r\n  const { id } = useParams() as { id: string };\r\n\r\n  const [practiceDate, setPracticeDate] = useState(\"\");\r\n  const [reflection, setReflection] = useState(\"\");\r\n  const [boardImages, setBoardImages] = useState<BoardImage[]>([]);\r\n  const [uploading, setUploading] = useState(false);\r\n\r\n  // 過去記録があればロード\r\n  useEffect(() => {\r\n    const recordsJson = localStorage.getItem(\"practiceRecords\") || \"[]\";\r\n    try {\r\n      const records: PracticeRecord[] = JSON.parse(recordsJson);\r\n      const rec = records.find((r) => r.lessonId === id);\r\n      if (rec) {\r\n        setPracticeDate(rec.practiceDate);\r\n        setReflection(rec.reflection);\r\n        setBoardImages(rec.boardImages);\r\n      }\r\n    } catch {\r\n      // ignore\r\n    }\r\n  }, [id]);\r\n\r\n  // 画像選択 → ローカルURLでプレビュー用にセット\r\n  const handleFileChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n    if (!e.target.files) return;\r\n    const files = Array.from(e.target.files);\r\n    const newImages = files.map((file) => ({\r\n      name: file.name,\r\n      src: URL.createObjectURL(file),\r\n    }));\r\n    setBoardImages((prev) => [...prev, ...newImages]);\r\n    e.target.value = \"\";\r\n  };\r\n\r\n  // 画像削除\r\n  const handleRemoveImage = (index: number) => {\r\n    setBoardImages((prev) => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  // ローカルストレージに保存\r\n  const saveToLocal = () => {\r\n    const recordsJson = localStorage.getItem(\"practiceRecords\") || \"[]\";\r\n    let records: PracticeRecord[] = [];\r\n    try {\r\n      records = JSON.parse(recordsJson);\r\n    } catch {\r\n      // ignore\r\n    }\r\n    const record: PracticeRecord = { lessonId: id, practiceDate, reflection, boardImages };\r\n    const idx = records.findIndex((r) => r.lessonId === id);\r\n    if (idx >= 0) records[idx] = record;\r\n    else records.push(record);\r\n    localStorage.setItem(\"practiceRecords\", JSON.stringify(records));\r\n  };\r\n\r\n  // Google Driveアップロード（PDF blobをアップロード）\r\n  const uploadPdfToDrive = async (blob: Blob) => {\r\n    const accessToken = process.env.NEXT_PUBLIC_GOOGLE_DRIVE_ACCESS_TOKEN;\r\n    if (!accessToken) throw new Error(\"Google Driveアクセストークンが設定されていません\");\r\n\r\n    const metadata = {\r\n      name: `practice_record_${id}.pdf`,\r\n      mimeType: \"application/pdf\",\r\n    };\r\n\r\n    const formData = new FormData();\r\n    formData.append(\"metadata\", new Blob([JSON.stringify(metadata)], { type: \"application/json\" }));\r\n    formData.append(\"file\", blob);\r\n\r\n    const res = await fetch(\r\n      \"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,webViewLink\",\r\n      {\r\n        method: \"POST\",\r\n        headers: {\r\n          Authorization: `Bearer ${accessToken}`,\r\n        },\r\n        body: formData,\r\n      }\r\n    );\r\n\r\n    if (!res.ok) {\r\n      const text = await res.text();\r\n      throw new Error(`Google Driveアップロード失敗: ${text}`);\r\n    }\r\n\r\n    return res.json();\r\n  };\r\n\r\n  // 保存ボタン押下処理\r\n  const handleSave = async (e: FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (!practiceDate.trim()) {\r\n      alert(\"実施日を入力してください\");\r\n      return;\r\n    }\r\n    if (!reflection.trim()) {\r\n      alert(\"振り返りを入力してください\");\r\n      return;\r\n    }\r\n\r\n    saveToLocal();\r\n\r\n    try {\r\n      const { default: html2pdf } = await import(\"html2pdf.js\");\r\n      const el = document.getElementById(\"practice-preview\");\r\n      if (!el) {\r\n        alert(\"プレビューが見つかりません\");\r\n        return;\r\n      }\r\n      const pdfBlob = await html2pdf().from(el).outputPdf(\"blob\");\r\n      await uploadPdfToDrive(pdfBlob);\r\n      alert(\"ローカル保存とGoogle Drive保存が完了しました！\");\r\n      router.push(\"/practice/history\");\r\n    } catch (error) {\r\n      alert(\"Google Driveへの保存に失敗しました。\");\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <main style={{ padding: 24, maxWidth: 800, margin: \"auto\", fontFamily: \"sans-serif\" }}>\r\n      <h2>実践記録作成・編集</h2>\r\n\r\n      <form onSubmit={handleSave}>\r\n        <label style={{ display: \"block\", marginBottom: 12 }}>\r\n          実施日：\r\n          <input\r\n            type=\"date\"\r\n            value={practiceDate}\r\n            onChange={(e) => setPracticeDate(e.target.value)}\r\n            required\r\n            style={{ width: \"100%\", padding: 8, marginTop: 4 }}\r\n          />\r\n        </label>\r\n\r\n        <label style={{ display: \"block\", marginBottom: 12 }}>\r\n          振り返り：\r\n          <textarea\r\n            value={reflection}\r\n            onChange={(e) => setReflection(e.target.value)}\r\n            required\r\n            rows={6}\r\n            style={{ width: \"100%\", padding: 8, marginTop: 4 }}\r\n          />\r\n        </label>\r\n\r\n        <label\r\n          style={{\r\n            display: \"block\",\r\n            marginBottom: 12,\r\n            padding: 8,\r\n            backgroundColor: \"#1976d2\",\r\n            color: \"#fff\",\r\n            borderRadius: 6,\r\n            textAlign: \"center\",\r\n            cursor: \"pointer\",\r\n          }}\r\n        >\r\n          📷 板書写真をアップロード\r\n          <input\r\n            type=\"file\"\r\n            multiple\r\n            accept=\"image/*\"\r\n            onChange={handleFileChange}\r\n            style={{ display: \"none\" }}\r\n          />\r\n        </label>\r\n\r\n        <div style={{ marginBottom: 16 }}>\r\n          {boardImages.map((img, i) => (\r\n            <div\r\n              key={`${img.name}-${i}`}\r\n              style={{ position: \"relative\", marginBottom: 12 }}\r\n            >\r\n              <img\r\n                src={img.src}\r\n                alt={img.name}\r\n                style={{ width: \"100%\", borderRadius: 8, border: \"1px solid #ccc\" }}\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                aria-label=\"画像を削除\"\r\n                onClick={() => handleRemoveImage(i)}\r\n                style={{\r\n                  position: \"absolute\",\r\n                  top: 8,\r\n                  right: 8,\r\n                  backgroundColor: \"rgba(229, 57, 53, 0.85)\",\r\n                  border: \"none\",\r\n                  borderRadius: \"50%\",\r\n                  color: \"white\",\r\n                  width: 28,\r\n                  height: 28,\r\n                  cursor: \"pointer\",\r\n                  fontWeight: \"bold\",\r\n                }}\r\n              >\r\n                ×\r\n              </button>\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {/* プレビュー */}\r\n        <section\r\n          id=\"practice-preview\"\r\n          style={{\r\n            padding: 16,\r\n            border: \"1px solid #ccc\",\r\n            borderRadius: 6,\r\n            backgroundColor: \"#fff\",\r\n            fontSize: 14,\r\n            lineHeight: 1.6,\r\n            marginBottom: 16,\r\n          }}\r\n        >\r\n          <h3>実施日: {practiceDate}</h3>\r\n          <h3>振り返り</h3>\r\n          <p>{reflection}</p>\r\n\r\n          {boardImages.length > 0 && (\r\n            <div style={{ marginTop: 12 }}>\r\n              <strong>板書写真</strong>\r\n              <div style={{ marginTop: 8, display: \"flex\", flexDirection: \"column\", gap: 12 }}>\r\n                {boardImages.map((img, i) => (\r\n                  <img\r\n                    key={`${img.name}-${i}-preview`}\r\n                    src={img.src}\r\n                    alt={img.name}\r\n                    style={{ width: \"100%\", borderRadius: 8, border: \"1px solid #ccc\" }}\r\n                  />\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </section>\r\n\r\n        <button\r\n          type=\"submit\"\r\n          style={{\r\n            padding: 12,\r\n            backgroundColor: \"#4CAF50\",\r\n            color: \"white\",\r\n            border: \"none\",\r\n            borderRadius: 6,\r\n            width: \"100%\",\r\n            cursor: \"pointer\",\r\n          }}\r\n        >\r\n          💾 保存（ローカル＋Drive）\r\n        </button>\r\n      </form>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 437, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yukia/Downloads/koku-lesson-planner/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0],"debugId":null}}]
}